<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Where in the World is Chris Graham?</title>
  <style>
    :root { --bg:#111; --fg:#33ff33; --panel:#000; --dim:#0a0a0a; }

    body{
      background:var(--bg); color:var(--fg);
      font-family:"Courier New",Courier,monospace;
      margin:0; padding:20px;
      display:flex; justify-content:center; align-items:center;
      min-height:100vh;
      text-shadow:0 0 5px rgba(51,255,51,.7);
    }

    #game-container{
      width:920px; max-width:100%;
      border:2px solid var(--fg);
      padding:18px;
      background-color:var(--panel);
      box-shadow:0 0 20px rgba(51,255,51,.2);
      overflow:hidden;

      /* IMPORTANT: scanlines as BACKGROUND, not overlay */
      background-image:
        linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,.28) 50%),
        linear-gradient(90deg, rgba(255,0,0,.05), rgba(0,255,0,.02), rgba(0,0,255,.05));
      background-size:100% 2px, 3px 100%;
    }

    h1{
      text-align:center;
      border-bottom:1px dashed var(--fg);
      padding-bottom:10px;
      margin:0 0 14px 0;
      letter-spacing:1px;
    }

    #screen{
      min-height:280px;
      margin-bottom:14px;
      white-space:pre-wrap;
      line-height:1.5;
    }

    .status-bar{
      display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between;
      border-bottom:1px solid var(--fg);
      margin-bottom:12px; padding-bottom:6px;
      font-weight:bold;
    }

    .controls{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    button{
      background:rgba(0,0,0,.90);
      color:var(--fg);
      border:1px solid var(--fg);
      padding:14px;
      font-family:"Courier New",Courier,monospace;
      font-size:16px;
      text-transform:uppercase;

      /* iPad touch reliability */
      touch-action:manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }

    button:active{ transform:translateY(1px); }
    button:hover{ background:var(--fg); color:var(--panel); }

    .hidden{ display:none; }

    .panel{
      border:1px solid var(--fg);
      padding:10px;
      background:rgba(0,0,0,.88);
      margin-top:10px;
    }

    .small{ font-size:14px; opacity:.92; }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>ACME CRIME NET</h1>

    <div class="status-bar hidden" id="statusBar">
      <span id="locationDisplay">LOC: UNKNOWN</span>
      <span id="timeDisplay">TIME: 0.0 DAYS</span>
      <span id="scoreDisplay">SCORE: 0</span>
      <span id="caseDisplay">CASE: 0</span>
    </div>

    <div id="screen">CONNECTING TO INTERPOL DATABASE...

LOADING SUSPECT PROFILE: CHRIS GRAHAM...

PRESS START TO BEGIN MISSION.</div>

    <div class="controls" id="controls">
      <button id="startBtn" type="button">START GAME</button>
      <button id="howBtn" type="button">HOW TO PLAY</button>
    </div>

    <div class="panel hidden" id="extraPanel"></div>
  </div>

<script>
"use strict";

/* If anything errors, show it on screen instead of silent failure */
window.onerror = function(msg, src, line, col){
  const s = document.getElementById("screen");
  s.textContent = "SCRIPT ERROR\n\n" + msg + "\nLine " + line + " Col " + col;
  return false;
};

const screen = document.getElementById("screen");
const controls = document.getElementById("controls");
const statusBar = document.getElementById("statusBar");
const locDisplay = document.getElementById("locationDisplay");
const timeDisplay = document.getElementById("timeDisplay");
const scoreDisplay = document.getElementById("scoreDisplay");
const caseDisplay = document.getElementById("caseDisplay");
const extraPanel = document.getElementById("extraPanel");

const SUSPECT = "Chris Graham";

const DIFFICULTY = {
  "1": { name:"Intern", days:7.0, mult:1.0 },
  "2": { name:"Detective", days:5.0, mult:1.5 },
  "3": { name:"Chief", days:4.0, mult:2.5 }
};

const STOLEN = [
  "A clean project baseline that never slips",
  "The one spreadsheet that has perfect formatting",
  "The delete button for unnecessary meetings",
  "Every left sock in the laundry",
  "A mythical day with zero emails"
];

const LOCATIONS = {
  "Las Vegas": { clues:["He mentioned a pump project like it is normal small talk.","He asked for a process people will actually follow.","He wanted KPIs, immediately."] },
  "New York": { clues:["He folded his pizza slice like it is policy.","He yelled at a taxi driver in Times Square.","He asked for the fastest route, twice."] },
  "London": { clues:["He tried to pay with pounds and asked for exact change.","He asked where Big Ben is.","He complained about rain like it is a project risk."] },
  "Paris": { clues:["He carried a baguette like evidence.","He asked where the Louvre was.","He said bonjour, then asked for the fastest route anyway."] },
  "Tokyo": { clues:["He wanted the best sushi and a second opinion.","He bought a bullet train ticket.","He asked for live data, not yesterday's data."] },
  "Sydney": { clues:["He asked where to find kangaroos, immediately.","He mentioned the Opera House.","He asked what time the market opens back home."] }
};

function r(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(a){
  const b=a.slice();
  for(let i=b.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [b[i],b[j]]=[b[j],b[i]];
  }
  return b;
}

/* Game state */
let path=[], idx=0, city="", days=7.0, mult=1.0, score=0, caseNo=0;

function update(){
  locDisplay.textContent = "LOC: " + (city||"UNKNOWN").toUpperCase();
  timeDisplay.textContent = "TIME: " + days.toFixed(1) + " DAYS";
  scoreDisplay.textContent = "SCORE: " + score;
  caseDisplay.textContent = "CASE: " + caseNo;
}

function setControls(html){ controls.innerHTML = html; }

function showHow(){
  extraPanel.classList.add("hidden");
  screen.textContent =
`HOW TO PLAY

Investigate costs 0.5 day and gives a clue about the next correct city.
Travel costs 1.0 day and you pick a destination.
Reach the final city before time runs out.`;
  setControls(`<button id="backBtn" type="button">BACK</button>`);
  bindOnce("backBtn", boot);
}

function boot(){
  statusBar.classList.add("hidden");
  extraPanel.classList.add("hidden");
  screen.textContent =
`ACME CRIME NET ONLINE

Select NEW CASE to begin.`;
  setControls(`
    <button id="newBtn" type="button">NEW CASE</button>
    <button id="how2Btn" type="button">HOW TO PLAY</button>
  `);
  bindOnce("newBtn", difficultyMenu);
  bindOnce("how2Btn", showHow);
}

function difficultyMenu(){
  screen.textContent =
`NEW CASE SETUP

1 Intern     7.0 days
2 Detective  5.0 days
3 Chief      4.0 days`;
  setControls(`
    <button id="d1" type="button">1 INTERN</button>
    <button id="d2" type="button">2 DETECTIVE</button>
    <button id="d3" type="button">3 CHIEF</button>
    <button id="cancel" type="button">CANCEL</button>
  `);
  bindOnce("d1", ()=>start("1"));
  bindOnce("d2", ()=>start("2"));
  bindOnce("d3", ()=>start("3"));
  bindOnce("cancel", boot);
}

function start(k){
  const level = DIFFICULTY[k] || DIFFICULTY["1"];
  days = level.days; mult = level.mult;
  score = 0;
  caseNo = Math.floor(1000 + Math.random()*9000);

  const cities = shuffle(Object.keys(LOCATIONS));
  path = cities.slice(0, 4);
  idx = 0;
  city = path[0];

  const item = r(STOLEN);

  statusBar.classList.remove("hidden");
  update();

  screen.textContent =
`URGENT MESSAGE

SUSPECT: ${SUSPECT}
THEFT: ${item}

Last confirmed location: ${city}
You have ${days.toFixed(1)} days.

Tap INVESTIGATE or TRAVEL.`;

  mainMenu();
}

function mainMenu(){
  update();
  if(days <= 0){ return fail(); }
  if(city === path[path.length-1]){ return win(); }

  setControls(`
    <button id="inv" type="button">INVESTIGATE</button>
    <button id="trav" type="button">TRAVEL</button>
  `);
  bindOnce("inv", investigate);
  bindOnce("trav", travelMenu);
}

function investigate(){
  days = Math.max(0, days - 0.5);
  update();

  const next = path[idx+1];
  const clue = r(LOCATIONS[next].clues);

  screen.textContent =
`INVESTIGATION REPORT

A witness says:
"${clue}"

Time spent: 0.5 day`;

  setControls(`<button id="cont" type="button">CONTINUE</button>`);
  bindOnce("cont", mainMenu);
}

function travelMenu(){
  const correct = path[idx+1];
  const all = Object.keys(LOCATIONS).filter(c => c !== city);
  const wrong = shuffle(all.filter(c=>c!==correct)).slice(0,2);
  const options = shuffle([correct].concat(wrong));

  screen.textContent = "DEPARTURE BOARD\n\nPick a destination:";
  setControls(options.map((c,i)=>`<button class="dest" data-city="${c}" type="button">${c.toUpperCase()}</button>`).join("") +
              `<button id="cancel2" type="button">CANCEL</button>`);

  /* Event delegation, pointerup is more reliable on iPad Edge */
  controls.querySelectorAll(".dest").forEach(btn=>{
    btn.addEventListener("pointerup", ()=>travelTo(btn.dataset.city), { passive:true });
    btn.addEventListener("click", ()=>travelTo(btn.dataset.city), { passive:true });
  });
  bindOnce("cancel2", mainMenu);
}

function travelTo(dest){
  days = Math.max(0, days - 1.0);
  update();

  const correct = path[idx+1];

  if(dest === correct){
    city = dest; idx++;
    score += 250;
    screen.textContent = `ARRIVAL CONFIRMED\n\nCorrect. Trail is warm in ${dest}.\n\nScore +250`;
  } else {
    city = dest;
    score = Math.max(0, score - 150);
    screen.textContent = `ARRIVAL CONFIRMED\n\nWrong city: ${dest}.\n\nScore -150`;
  }

  setControls(`<button id="cont2" type="button">CONTINUE</button>`);
  bindOnce("cont2", mainMenu);
}

function win(){
  const final = Math.floor((1000 + score + Math.floor(days*250)) * mult);
  screen.textContent = `CASE CLOSED\n\nYou found ${SUSPECT} in ${city}.\n\nFINAL SCORE: ${final}`;
  setControls(`<button id="again" type="button">NEW CASE</button>`);
  bindOnce("again", difficultyMenu);
}

function fail(){
  screen.textContent = `MISSION FAILED\n\nTime ran out.\n${SUSPECT} escaped.`;
  setControls(`<button id="again2" type="button">NEW CASE</button>`);
  bindOnce("again2", difficultyMenu);
}

/* Helper: bind once using pointerup + click */
function bindOnce(id, fn){
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener("pointerup", fn, { passive:true });
  el.addEventListener("click", fn, { passive:true });
}

/* Initial bindings */
function init(){
  // Instant tap test: if this does not change text, taps are being blocked by browser/overlay.
  const startBtn = document.getElementById("startBtn");
  const howBtn = document.getElementById("howBtn");

  startBtn.addEventListener("pointerup", ()=>{ screen.textContent = "INPUT RECEIVED. LOADING..."; boot(); }, { passive:true });
  startBtn.addEventListener("click", ()=>{ screen.textContent = "INPUT RECEIVED. LOADING..."; boot(); }, { passive:true });

  howBtn.addEventListener("pointerup", showHow, { passive:true });
  howBtn.addEventListener("click", showHow, { passive:true });
}

init();
</script>
</body>
</html>
